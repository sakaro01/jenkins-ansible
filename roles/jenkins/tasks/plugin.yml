---
- name: Wait for port {{ jenkins_port }} availability
  wait_for: port={{ jenkins_port }} timeout=60
  tags:
    - jenkins
    - plugin

- name: Install git
  yum: name=git state=latest
  tags:
    - jenkins
    - plugin

- name: Get jenkins cli
  get_url: url={{ jenkins_cli_url }} dest={{ jenkins_cli_dest }}
  register: result
  until: result.msg.find("Request failed") == -1
  retries: 5
  delay: 10
  tags:
    - jenkins
    - plugin

- debug: var=result

- name: Wait for updates/default.json to exist
  wait_for: path=/var/lib/jenkins/updates/default.json timeout=180
  tags:
    - jenkins
    - plugin

- name: Install git plugin
  command: java  -jar {{ jenkins_cli_dest }} -s http://{{ jenkins_host_name }}:{{ jenkins_port }} install-plugin git
  tags:
    - jenkins
    - plugin

- name: Restart jenkins
  command: java -jar {{ jenkins_cli_dest }} -s http://{{ jenkins_host_name }}:{{ jenkins_port }} safe-restart
  tags:
    - jenkins
    - plugin